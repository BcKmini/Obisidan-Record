####  ë¼ì§€ë² ë¦¬ íŒŒì´ 4 GPIO í•€ë§µ(ì „ë ¥ì†Œë¹„ëŸ‰, ì¹´ë©”ë¼ ì—°ê²°)

![[3ba0558a7a95e349d08ecdde3d021e8e.jpg]]
#### [ë¼ì¦ˆë² ë¦¬íŒŒì´ ì¹´ë©”ë¼ëª¨ë“ˆ 3] Raspberry Pi Camera Module 3

![[images.jpg]]

![[ì—°ê²°.jpg]]
---
## **ğŸ“Œ ë¼ì¦ˆë² ë¦¬íŒŒì´ì—ì„œ INA219ë¥¼ ì‚¬ìš©í•˜ì—¬ ì „ë ¥ ì†Œë¹„ëŸ‰ ì¸¡ì •í•˜ê¸° (ë²„íŠ¼ ON/OFF ê¸°ëŠ¥ í¬í•¨)**

### **ğŸ“¦ ì‚¬ìš© ë¶€í’ˆ**

-  **ë¼ì¦ˆë² ë¦¬íŒŒì´ 4 Model B**
-  **INA219 DC ì „ë¥˜/ì „ì•• ì„¼ì„œ**
-  **í‘¸ì‹œ ë²„íŠ¼ (Toggle ë°©ì‹)**
-  **ì í¼ ì™€ì´ì–´**
- **5V USB-C ì „ì› (ë¼ì¦ˆë² ë¦¬íŒŒì´ìš©)**

---
### **ğŸ“Œ  I2C í†µì‹  ì—°ê²° 

| **INA219 í•€** | **ë¼ì¦ˆë² ë¦¬íŒŒì´ GPIO í•€**                 | **BCM í•€ë²ˆí˜¸** | **ì„¤ëª…**       |
| ------------ | --------------------------------- | ----------- | ------------ |
| **VCC**      | **3.3V (í•€ 1)** ë˜ëŠ” **5V (í•€ 2, 4)** | -           | INA219 ì„¼ì„œ ì „ì› |
| **GND**      | **GND (í•€ 6)**                     | -           | ê³µí†µ ì ‘ì§€        |
| **SDA**      | **GPIO2 (í•€ 3)**                   | **BCM 2**   | I2C ë°ì´í„°      |
| **SCL**      | **GPIO3 (í•€ 5)**                   | **BCM 3**   | I2C í´ëŸ­       |

> INA219ì™€ ë¼ì¦ˆë² ë¦¬íŒŒì´ê°€ I2C í†µì‹  ê°€ëŠ¥

---

### **ğŸ“Œë¼ì¦ˆë² ë¦¬íŒŒì´ ì „ë ¥ ì¸¡ì •ìš© ì—°ê²°**

| **INA219 í•€** | **ë¼ì¦ˆë² ë¦¬íŒŒì´ ì—°ê²° ìœ„ì¹˜**                   | **ì„¤ëª…**                    |
| ------------ | ---------------------------------- | ------------------------- |
| **Vin+**     | **USB-C ì „ì›(5V)ì˜ + (VCC) ë‹¨ì**       | **ë¼ì¦ˆë² ë¦¬íŒŒì´ì— ë“¤ì–´ê°€ê¸° ì „ì˜ ì „ë ¥ ì¸¡ì •** |
| **Vin-**     | **ë¼ì¦ˆë² ë¦¬íŒŒì´ 5V (Physical 2 ë˜ëŠ” 4ë²ˆ í•€)** | **ì „ë ¥ ê³µê¸‰ ì¸¡ì •**              |

>ë¼ì¦ˆë² ë¦¬íŒŒì´ì— ë“¤ì–´ì˜¤ëŠ” ì „ë ¥ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¸¡ì • ê°€ëŠ¥
>GNDëŠ” ë°˜ë“œì‹œ ê³µí†µìœ¼ë¡œ ì—°ê²°í•´ì•¼ í•¨ (USB-C â†’ INA219 â†’ ë¼ì¦ˆë² ë¦¬íŒŒì´)

---

### **ğŸ“Œë²„íŠ¼ ì—°ê²° (ON/OFF ê¸°ëŠ¥)**

|**ë²„íŠ¼ í•€**|**ë¼ì¦ˆë² ë¦¬íŒŒì´ GPIO í•€**|
|---|---|
|**VCC**|**3.3V (Physical 1ë²ˆ í•€)**|
|**GND**|**GND (Physical 6ë²ˆ í•€)**|
|**OUT**|**GPIO 17 (Physical 11ë²ˆ í•€, BCM 17)**|

> **ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ON/OFF ìƒíƒœ ì „í™˜ ê°€ëŠ¥** (í›„ì— ë¼ì¦ˆë² ì´íŒŒì´ ì „ì› ì—°ê²°)

---

# ğŸ“Œ ì†Œí”„íŠ¸ì›¨ì–´ ì„¤ì •
-  **I2C í™œì„±í™” (í•„ìˆ˜)**
```bash
sudo raspi-config
# Interface Options â†’ I2C â†’ Enable ì„¤ì • í›„ ì¬ë¶€íŒ…
```
-  í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
```bash
sudo apt update && sudo apt install -y python3-pip
pip3 install adafruit-circuitpython-ina219 pigpio

```
-  pigpio ì‹¤í–‰
```bash
sudo systemctl enable pigpiod
sudo systemctl start pigpiod
```
-  I2C ì¥ì¹˜ í™•ì¸
```bash
sudo i2cdetect -y 1
```
-  ì¶œë ¥ì—ì„œ `0x40`ì´ ê°ì§€ë˜ë©´ ì •ìƒ

---
# ğŸ“Œ í”„ë¡œì íŠ¸ ë¹Œë“œ ë° ì‹¤í–‰
-  í”„ë¡œì íŠ¸ í´ë” êµ¬ì„±
```bash
switch/
â”‚â”€â”€ include/
â”‚   â”œâ”€â”€ gpio_control.h
â”‚   â”œâ”€â”€ ina219_sensor.h
â”‚
â”‚â”€â”€ src/
â”‚   â”œâ”€â”€ main.cpp
â”‚   â”œâ”€â”€ gpio_control.cpp
â”‚   â”œâ”€â”€ ina219_sensor.cpp
â”‚
â”‚â”€â”€ CMakeLists.txt
```

-  `CMakeLists.txt` ì„¤ì •
```cmake
cmake_minimum_required(VERSION 3.10)
project(switch_control)

set(CMAKE_CXX_STANDARD 17)

# pigpio ë¼ì´ë¸ŒëŸ¬ë¦¬ í¬í•¨
find_library(PIGPIO_LIB pigpio REQUIRED)

include_directories(include)
add_executable(switch src/main.cpp src/gpio_control.cpp src/ina219_sensor.cpp)

# pigpio ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€
target_link_libraries(switch ${PIGPIO_LIB} pthread)
```

> ğŸ’» main.cpp
```cpp
#include "gpio_control.h"
#include "ina219_sensor.h"
#include <iostream>
#include <csignal>
#include <gtk/gtk.h>
#include <thread>
#include <chrono>

#define BUTTON_PIN 17

bool running = true;
GtkWidget *label;

// SIGINT í•¸ë“¤ëŸ¬
void signalHandler(int signum) {
    running = false;
    std::cout << "Exiting program..." << std::endl;
}

// GUI ì—…ë°ì´íŠ¸
void updateDisplay(float voltage, float current, float power) {
    char buffer[256];
    snprintf(buffer, sizeof(buffer),
             "ì „ì••  : %.3f V\n"
             "ì „ë¥˜  : %.3f A\n"
             "ì „ë ¥  : %.3f W\n",
             voltage, current, power);
    gtk_label_set_text(GTK_LABEL(label), buffer);
}

// ì „ë ¥ ì¸¡ì • ìŠ¤ë ˆë“œ
void powerMonitorThread(INA219Sensor *sensor) {
    while (running) {
        float voltage = sensor->getBusVoltage();
        float current = sensor->getCurrent();
        float power = voltage * current;
        g_idle_add((GSourceFunc)updateDisplay, new float[3]{voltage, current, power});
        std::this_thread::sleep_for(std::chrono::seconds(1));
    }
}

// GTK UI ì„¤ì •
static void activate(GtkApplication *app, gpointer user_data) {
    GtkWidget *window;
    window = gtk_application_window_new(app);
    gtk_window_set_title(GTK_WINDOW(window), "ì „ë ¥ ëª¨ë‹ˆí„°ë§");
    gtk_window_set_default_size(GTK_WINDOW(window), 300, 200);
    label = gtk_label_new("Loading...");
    gtk_container_add(GTK_CONTAINER(window), label);
    gtk_widget_show_all(window);
}

// ì‹¤í–‰ ì½”ë“œ
int main(int argc, char **argv) {
    signal(SIGINT, signalHandler);
    if (gpioInitialise() < 0) {
        std::cerr << "pigpio ì´ˆê¸°í™” ì‹¤íŒ¨!" << std::endl;
        return 1;
    }
    GPIOControl button(BUTTON_PIN);
    INA219Sensor powerSensor;

    GtkApplication *app = gtk_application_new("com.raspberrypi.power_monitor", G_APPLICATION_DEFAULT_FLAGS);
    g_signal_connect(app, "activate", G_CALLBACK(activate), NULL);

    std::thread powerThread(powerMonitorThread, &powerSensor);
    g_application_run(G_APPLICATION(app), argc, argv);

    powerThread.join();
    gpioTerminate();
    return 0;
}
```

-  í”„ë¡œì íŠ¸ ë¹Œë“œ
```bash
mkdir build && cd build
cmake ..
make

# ì‹¤í–‰
sudo ./switch
```
