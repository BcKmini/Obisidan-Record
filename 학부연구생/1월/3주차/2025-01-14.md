### 9:30 íšŒì˜ ì§„í–‰ 
DBë‚´ìš© ë¨¼ì € ì§„í–‰
(ì—°êµ¬ì™€ ê´€ë ¨ëœ ê°œë°œì„ ë¨¼ì € ìš°ì„ ìˆœìœ„ë¥¼ ë‘¬ì„œ ì§„í–‰)

ì—°êµ¬ì‹¤
# í•„ìš”í•˜ë‹¤ ìƒê°í•˜ëŠ” ê²ƒ ì ê¸°

## Task

1. GPS ê¸°ë°˜ ë¶„ì„ ì‹œìŠ¤í…œ
2. Hardware ì‹œìŠ¤í…œ
3. ì•¼ìƒë™ë¬¼ ì œì–´ ì‹œìŠ¤í…œ ì›¹
4. ì•¼ìƒë™ë¬¼ ì œì–´ ì‹œìŠ¤í…œ ì•±
5. ì•¼ìƒë™ë¬¼ íƒì§€ ì‹œìŠ¤í…œ
6. ì•¼ìƒë™ë¬¼ ë°ì´í„° ìˆ˜ì§‘ ì•±

- ë‚´ìš©ì„ ì…ë ¥í•  ìˆ˜ ìˆëŠ” ê²Œì‹œíŒ í˜•ì‹ìœ¼ë¡œ ë§Œë“¤ì–´ì•¼ í•¨
- ë‹¨ìˆœí•˜ê²Œ ë§Œë“¤ì–´ì„œ í™•ì¥í•´ì„œ ê°œë°œí•˜ëŠ” í˜•ì‹
- í‹°ë¹„ í•´ìƒë„ì— ë§ì¶°ì„œ ì–´ë–¤ ê³µê°„ì— ë¬´ì—‡ì„ ë„£ì„ ê²ƒì¸ì§€ ì •í•˜ê¸°
    - ìµœëŒ€ í”½ì…€ í™•ì¸í•˜ê¸°

---

3x2ë¡œ ì´ 6ê°œì˜ ëŒ€ì‹œë³´ë“œë¥¼ ë‚˜ëˆŒ ì˜ˆì •

1. ì—°êµ¬ì ëª©ë¡ - ì§ì±…, ì—…ë¬´
    
2. í‡´ì¹˜ ê¸°ê¸° ì •ë³´
    
    - ê°œë°œ í•  ëª©ë¡ ë¦¬ìŠ¤íŠ¸, ê°œë°œ ì¤‘ì¸ ëª©ë¡ ë¦¬ìŠ¤íŠ¸, ì „ì‹œ ëª©ë¡ ë¦¬ìŠ¤íŠ¸ â†’ ì„¸ë¶€ ì¼ì • ë“± ì‚¬ìš©ìê°€ ë“±ë¡í•´ì„œ ì˜¬ë¦¬ëŠ” ë°©ì•ˆìœ¼ë¡œ ê°œë°œ
    - Gantt chart í˜•ì‹ìœ¼ë¡œ ë„ìš°ê¸° â†’ google Calender API ë°›ì•„ì˜¤ê¸° â†’ Notionì—°ë™ ê°€ëŠ¥
3. ì§„í–‰ í˜„í™©
    
    - ê¸°ê¸° ì •ë³´, ì—ëŸ¬, ì§„í–‰ ìƒí™©
    - ìŠ¬ë™ì—ì„œ Todo List ëŒ€ì‹œë³´ë“œ ë“±ë¡ â†’ ëŒ€ì‹œë³´ë“œì—ë„ ë“±ë¡ë˜ê²Œ ë§Œë“¤ê¸°
        - ì´ë²ˆì£¼ ëª©í‘œ ì ê¸°, í•œë‹¬ ëª©í‘œ ì •í•´ì„œ ì²´í¬ë°•ìŠ¤ë¡œ í‘œì‹œë˜ê²Œ ë§Œë“¤ê¸°
4. DB ì •ë³´ (ìš°ì„ ìˆœìœ„ : ìƒ)
    
    - Repellent_data
    - Repellent_sound
    - Repellent_device
    - GPS
    
    **ì´ë²ˆì£¼ ê¹Œì§€ ëª©í‘œ**
    
5. DB ë°ì´í„° ìˆ˜ì§‘ëœ ì¢… ë¶„í¬ ë„ì›Œë†“ê¸°
    
    - [ì•¼ìƒë™ë¬¼ íƒì§€ DB í˜„í™©](https://www.notion.so/DB-12cec508cf3c8066add2e330936dbfd9?pvs=21) DBì— ê·¸ëŒ€ë¡œ ìˆìœ¼ë‹ˆ í™•ì¸í•´ì„œ ë„ì›Œë†“ê¸°
6. ë™ë¬¼ ì œì–´ ë°©ì‹ ë¶„ë¥˜ ë° ë¬¸ì„œí™”
    

- [ë™ë¬¼ ì œì–´ ë°©ì‹ ë¶„ë¥˜ ë° ë¬¸ì„œí™”](https://www.notion.so/12cec508cf3c8025891eda23dacc3ea5?pvs=21)

![[ìŠ¤í¬ë¦°ìƒ· 2024-12-13 ì˜¤í›„ 1.12.04.png]]

ë™ë¬¼ ì œì–´ ë°©ì‹ ë¬¸ì„œí™”ì— ìˆëŠ” ì´ë¯¸ì§€ë¥¼ ë³´ê³  ê±°ë¦¬ë¥¼ í´ë¦­í•˜ë©´ ê·¸ì— ë§ê²Œ 5m ì´ë‚´ì¼ì§€, ì´ìƒì¸ì§€ ì„ íƒí•´ì„œ ê·¸ ë¶€ë¶„ì´ ê°•ì¡°ë˜ë„ë¡ í•˜ê³ , ì í˜€ìˆëŠ” ì •ë³´ë“¤ì˜ ê·¼ê±° ìë£Œë“¤ë„ ë³´ì´ê²Œ í•˜ëŠ”ê²Œ ì¢‹ì„ë“¯

ì¶”í›„ì—ëŠ” ì‹¤í—˜ê²°ê³¼ì™€ ì—°ê´€ì§€ì–´ë„ ë  ë“¯í•¨.

1. ì£¼ë§ˆë‹¤ ìˆ˜ì§‘í•œ ë°ì´í„° ì´ë¦„: ì´ë¯¸ì§€ ì¥ ìˆ˜ ìˆ˜ëŸ‰ í•„ìš”


> ë‹¨ìˆœí•˜ê²Œ ë§Œë“¤ì–´ì„œ í™•ì¥í•˜ê¸°

## êµìˆ˜ë‹˜ í”¼ë“œë°±
ì‹œìŠ¤í…œ ì „ë°˜ì ì¸ ì¥ì¹˜bc, ê¸°ê¸°db, ì›Œí‚¹?dbë¥¼ ì´ìš©í•´ì„œ ì›¹ì— ë°”ë¡œ ë¿Œë ¤ì£¼ëŠ” ê¸°ëŠ¥ë¶€í„° ì‹œì‘í•˜ê¸°
- DBë¥¼ ì–´ë–¤ ê·¸ë˜í”„ë¥¼ ì´ìš©í•´ì„œ í‘œí˜„í• ì§€ ê³ ë¯¼í•˜ê¸°


í‡´ì¹˜ê¸°ê¸°ê°€ íƒì§€í•œê±°
data
devie -> ê¸°ê¸° ìì²´
sound -> í‡´ì¹˜ê¸°ê¸°ê°€ ì‚¬ìš´ë“œë¥¼ ë‚¸ê±°

-> 

---

# ğŸ“Œ ORM(Object Relational Mapping)
# ORM(Object Relational Mapping)

##  ORMì´ë€?
- ê°ì²´ì™€ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ë§¤í•‘í•´ì£¼ëŠ” í”„ë ˆì„ì›Œí¬
- SQL ëŒ€ì‹  ê°ì²´ë¥¼ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì¡°ì‘í•  ìˆ˜ ìˆìŒ

##  SQLAlchemyë€?
- Python ORM ë¼ì´ë¸ŒëŸ¬ë¦¬
- SQL ì¿¼ë¦¬ ì—†ì´ ê°ì²´ë¡œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì¡°ì‘ ê°€ëŠ¥
- DB ì¢…ë¥˜ì™€ ìƒê´€ì—†ì´ ì¼ê´€ëœ ì½”ë“œ ìœ ì§€

---

# FastAPIì™€ MySQL(DB) ì—°ê²°í•˜ê¸°

## ë””ë ‰í„°ë¦¬ êµ¬ì¡°
`## ë””ë ‰í„°ë¦¬ êµ¬ì¡°`

. â”œâ”€â”€ app.py â”œâ”€â”€ models.py â””â”€â”€ database.py


```python
# `database.py`
- SQLAlchemyë¥¼ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°

```python
from sqlalchemy import *
from sqlalchemy.orm import sessionmaker

DB_URL = 'mysql+pymysql://{USERNAME}:{PASSWORD}@{HOST}:{PORT}/{DBNAME}'

class engineconn:
    def __init__(self):
        self.engine = create_engine(DB_URL, pool_recycle=500)

    def sessionmaker(self):
        Session = sessionmaker(bind=self.engine)
        return Session()

    def connection(self):
        return self.engine.connect()

```
```
```
---
```python
# `models.py`

## í…Œì´ë¸”ê³¼ ë§¤í•‘í•  ëª¨ë¸ ì •ì˜

from sqlalchemy import Column, TEXT, INT, BIGINT
from sqlalchemy.ext.declarative import declarative_base

Base = declarative_base()

class Test(Base):
    __tablename__ = "test"

    id = Column(BIGINT, nullable=False, autoincrement=True, primary_key=True)
    name = Column(TEXT, nullable=False)
    number = Column(INT, nullable=False)
```
```
```

```python

#  `app.py`

## FastAPIë¥¼ ì‚¬ìš©í•˜ì—¬ API êµ¬í˜„

from fastapi import FastAPI
from pydantic import BaseModel
from database import engineconn
from models import Test

app = FastAPI()
engine = engineconn()
session = engine.sessionmaker()

class Item(BaseModel):
    name: str
    number: int

@app.get("/")
async def first_get():
    example = session.query(Test).all()
    return example

```

>ì‹¤í–‰ ->  uvicorn app:app --reload

---
#  ğŸ“Œ Fastapi + HTTP í†µì‹ 

## Requests ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°œìš” ë° í™˜ê²½ì„¤ì •

Requests ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” HTTP í†µì‹ ì„ ìœ„í•œ ë‹¤ì–‘í•œ ë©”ì„œë“œ(get, post, patch, put, delete ë“±)ë¥¼ ì œê³µí•˜ì—¬ REST API í˜¸ì¶œ ë° ë°ì´í„° ìš”ì²­/ìˆ˜ì •ì„ ê°„í¸í•˜ê²Œ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ê°€ìƒí™˜ê²½ ìƒì„± ë° Requests ì„¤ì¹˜

```python
python -m venv venv
source venv/scripts/activate
pip install requests
```

## FastAPIì™€ Requestsë¥¼ í™œìš©í•œ HTTP í†µì‹ 

FastAPIëŠ” ë¹ ë¥´ê³  í˜„ëŒ€ì ì¸ Python ì›¹ í”„ë ˆì„ì›Œí¬ë¡œ, requestsì™€ í•¨ê»˜ ì‚¬ìš©í•˜ë©´ íš¨ìœ¨ì ì¸ ì›¹ ê°œë°œì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### FastAPI ì„¤ì¹˜

```bash
pip install "fastapi[all]"
```

### 1. GET ìš”ì²­ ì˜ˆì œ

#### ì„œë²„ ì„¤ì • (server.py)

```python
from typing import Union
from fastapi import FastAPI

app = FastAPI()

@app.get("/")
def read_root():
    return {"Hello": "World"}

@app.get("/items/{item_id}")
def read_item(item_id: int, q: Union[str, None] = None):
    return {"item_id": item_id, "q": q}
```

#### í´ë¼ì´ì–¸íŠ¸ ì„¤ì • (client.py)

```python
import requests

url = "http://localhost:8000"
resp = requests.get(url=url)

print(f"status_code: {resp.status_code}")
print(f"content: {resp.content}")
print(f"headers: {resp.headers}")
```

**ì¶œë ¥ ê²°ê³¼**:

```
status_code: 200
content: b'{"Hello":"World"}'
headers: {...}
```

#### Query Stringì„ í™œìš©í•œ GET ìš”ì²­

```python
url = "http://localhost:8000/items/1"
resp = requests.get(url=url, params={"q": 1})

print(f"status_code: {resp.status_code}")
print(f"content: {resp.content}")
print(f"headers: {resp.headers}")
```

**ì¶œë ¥ ê²°ê³¼**:

```
status_code: 200
content: b'{"item_id":1,"q":"1"}'
headers: {...}
```

### 2. POST ìš”ì²­ ì˜ˆì œ

#### ì„œë²„ ì„¤ì • (server.py)

```python
from pydantic import BaseModel
from fastapi import FastAPI

app = FastAPI()

class UserData(BaseModel):
    user_name: str
    password: str

@app.post("/login")
def login(user_data: UserData):
    return {"user_data": user_data}
```

#### í´ë¼ì´ì–¸íŠ¸ ì„¤ì • (client.py)

```python
import requests

url = "http://localhost:8000/login"
data = {
    "user_name": "earthquake",
    "password": "pass123word123"
}

resp = requests.post(url=url, json=data)

print(f"status_code: {resp.status_code}")
print(f"content: {resp.content}")
print(f"headers: {resp.headers}")
```

**ì¶œë ¥ ê²°ê³¼**:

```
status_code: 200
content: b'{"user_data":{"user_name":"earthquake","password":"pass123word123"}}'
headers: {...}
```

## í”„ë¡œì íŠ¸ ì ìš© ì‚¬ë¡€

Jobdam í”„ë¡œì íŠ¸ì—ì„œ requestsë¥¼ í™œìš©í•˜ì—¬ HTTP í†µì‹ ì„ êµ¬í˜„í•œ ì˜ˆì‹œëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

### ì˜ˆì œ í•¨ìˆ˜: ì±„íŒ…ë°© ìƒì„± ìš”ì²­

```python
def create_chat_room(self, data: dict):
    resp = requests.post(
        url=cfg.base_url + "/chat_room/create",
        json=data,
        headers=auth_utils.build_jwt_header(cfg.config_path)
    )
    if resp.status_code == 201:
        create_room_resp = global_utils.bytes2dict(resp.content)
        return {"status_code": resp.status_code}
    elif resp.status_code == 400:
        detail = global_utils.bytes2dict(resp.content)['detail']
        return {"status_code": resp.status_code, "detail": detail}
    else:
        detail = global_utils.bytes2dict(resp.content)['detail']
        return {"status_code": resp.status_code, "detail": detail}
```

#### ì£¼ëª©í•  ì 

1. **í—¤ë” ì„¤ì •**:
    
    ```python
    def build_jwt_header(fpath):
        return {
            "Authorization": "Bearer " + get_access_token_from_json(fpath)
        }
    ```
    
2. **ì‘ë‹µ ë°ì´í„° ë³€í™˜**:
    
    ```python
    def bytes2dict(b):
        return json.loads(b.decode('utf-8'))
    ```
    

### ì°¸ê³  ìë£Œ

- [Requests ë¼ì´ë¸ŒëŸ¬ë¦¬ ê³µì‹ ë¬¸ì„œ](https://docs.python-requests.org)
- [FastAPI ê³µì‹ ë¬¸ì„œ](https://fastapi.tiangolo.com)

## ğŸ’» ì¶”ê°€ Python Requests ë¼ì´ë¸ŒëŸ¬ë¦¬

```HTTP
>>> import requests
>>> r = requests.get('https://httpbin.org/basic-auth/user/pass', auth=('user', 'pass'))
>>> r.status_code
200
>>> r.headers['content-type']
'application/json; charset=utf8'
>>> r.encoding
'utf-8'
>>> r.text
'{"authenticated": true, ...'
>>> r.json()
{'authenticated': True, ...}
```

### HTTP í†µì‹  ìš”ì²­ -> ì‘ë‹µ
```PYTHON
pip install requests # ì„¤ì¹˜í•˜ê¸°
```

---

## repellent-admin ì½”ë“œ ëœ¯ê¸°
>app/models/repellent_data.py

```python
from sqlalchemy import Column, Integer, String, DateTime, Time, ForeignKey, Enum

from sqlalchemy.orm import relationship

from .base import Base

  
  

class RepellentData(Base):

Â  Â  __tablename__ = "repellent_data"

  

Â  Â  id = Column(Integer, primary_key=True, index=True, autoincrement=True)

Â  Â  detection_date = Column(DateTime, nullable=False) Â # íƒì§€ ë‚ ì§œ

Â  Â  detection_num = Column(Integer, nullable=False) Â # íƒì§€ íšŸìˆ˜

Â  Â  detection_time = Column(String(255), nullable=False) Â # íƒì§€ ì‹œê°„

Â  Â  re_detection_minutes = Column(Integer, nullable=True) Â # ì¬íƒì§€ ì‹œê°„(ë¶„)

Â  Â  detection_type = Column(String(255), nullable=False) Â # íƒì§€ ìœ í˜•

Â  Â  gateway_id = Column(Integer, ForeignKey("gateway.id"), nullable=False)

Â  Â  repellent_device_id = Column(

Â  Â  Â  Â  Integer, ForeignKey("repellent_device.id"), nullable=False

Â  Â  )

Â  Â  species = Column(

Â  Â  Â  Â  Enum('wild_boar', 'jay', 'crow', 'magpie', 'pigeon', 'cormorant', 'sparrow', 'bulbul'),

Â  Â  Â  Â  nullable=True

Â  Â  )

Â  Â  repellent_sound_id = Column(

Â  Â  Â  Â  Integer, ForeignKey("repellent_sound.id"), nullable=False

Â  Â  )

  

Â  Â  # relationship ì„¤ì •

Â  Â  gateway = relationship("Gateway", back_populates="repellent_data")

Â  Â  repellent_device = relationship("RepellentDevice", back_populates="repellent_data")

Â  Â  repellent_sound = relationship("RepellentSound", back_populates="repellent_data")
```

# RepellentData ëª¨ë¸ ì„¤ëª…

## í…Œì´ë¸” ì´ë¦„
- `__tablename__ = "repellent_data"`

## ì»¬ëŸ¼ ì •ì˜
- **`id`**
  - íƒ€ì…: `Integer`
  - ì„¤ëª…: ê¸°ë³¸ í‚¤, ìë™ ì¦ê°€, ì¸ë±ìŠ¤ ì¶”ê°€
  - ì†ì„±: `primary_key=True`, `index=True`, `autoincrement=True`

- **`detection_date`**
  - íƒ€ì…: `DateTime`
  - ì„¤ëª…: íƒì§€ ë‚ ì§œ
  - ì†ì„±: `nullable=False`

- **`detection_num`**
  - íƒ€ì…: `Integer`
  - ì„¤ëª…: íƒì§€ íšŸìˆ˜
  - ì†ì„±: `nullable=False`

- **`detection_time`**
  - íƒ€ì…: `String(255)`
  - ì„¤ëª…: íƒì§€ ì‹œê°„
  - ì†ì„±: `nullable=False`

- **`re_detection_minutes`**
  - íƒ€ì…: `Integer`
  - ì„¤ëª…: ì¬íƒì§€ ì‹œê°„(ë¶„)
  - ì†ì„±: `nullable=True`

- **`detection_type`**
  - íƒ€ì…: `String(255)`
  - ì„¤ëª…: íƒì§€ ìœ í˜•
  - ì†ì„±: `nullable=False`

- **`gateway_id`**
  - íƒ€ì…: `Integer`
  - ì„¤ëª…: `gateway` í…Œì´ë¸”ì˜ `id`ë¥¼ ì°¸ì¡° (ì™¸ë˜ í‚¤)
  - ì†ì„±: `ForeignKey("gateway.id")`, `nullable=False`

- **`repellent_device_id`**
  - íƒ€ì…: `Integer`
  - ì„¤ëª…: `repellent_device` í…Œì´ë¸”ì˜ `id`ë¥¼ ì°¸ì¡° (ì™¸ë˜ í‚¤)
  - ì†ì„±: `ForeignKey("repellent_device.id")`, `nullable=False`

- **`species`**
  - íƒ€ì…: `Enum`
  - ì„¤ëª…: íƒì§€ëœ ë™ë¬¼ ì¢… (ì—´ê±°í˜•)
  - í—ˆìš©ê°’: 
    - `wild_boar`
    - `jay`
    - `crow`
    - `magpie`
    - `pigeon`
    - `cormorant`
    - `sparrow`
    - `bulbul`
  - ì†ì„±: `nullable=True`

- **`repellent_sound_id`**
  - íƒ€ì…: `Integer`
  - ì„¤ëª…: `repellent_sound` í…Œì´ë¸”ì˜ `id`ë¥¼ ì°¸ì¡° (ì™¸ë˜ í‚¤)
  - ì†ì„±: `ForeignKey("repellent_sound.id")`, `nullable=False`

## ê´€ê³„ ì •ì˜ (Relationship)
- **`gateway`**
  - ì„¤ëª…: `Gateway` ëª¨ë¸ê³¼ì˜ ê´€ê³„
  - ì„¤ì •: `relationship("Gateway", back_populates="repellent_data")`

- **`repellent_device`**
  - ì„¤ëª…: `RepellentDevice` ëª¨ë¸ê³¼ì˜ ê´€ê³„
  - ì„¤ì •: `relationship("RepellentDevice", back_populates="repellent_data")`

- **`repellent_sound`**
  - ì„¤ëª…: `RepellentSound` ëª¨ë¸ê³¼ì˜ ê´€ê³„
  - ì„¤ì •: `relationship("RepellentSound", back_populates="repellent_data")`
